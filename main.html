<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Gnoke Library</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Playfair+Display:wght@600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles/style.css" />
  <script>
    // Apply saved theme before paint to avoid flash
    (function(){
      if(localStorage.getItem('gnoke_theme')==='dark')
        document.documentElement.setAttribute('data-theme','dark');
    })();
  </script>
</head>
<body>

<!-- â”€â”€ Demo Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="demo-banner" style="display:none;">
  <span>ğŸ“š You're viewing demo data.</span>
  <button onclick="handleResetDemo()">Clear &amp; Start Fresh</button>
  <button class="dismiss" onclick="this.closest('#demo-banner').style.display='none'">âœ•</button>
</div>

<!-- â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="topbar">
  <button class="burger" id="burger-btn" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
  <div class="brand">
    <span class="brand-gnoke">Gnoke</span>
    <span class="brand-app">Library</span>
  </div>
  <button class="btn-topbar" id="theme-toggle" onclick="toggleTheme()" title="Toggle theme">ğŸŒ™</button>
  <button class="btn-topbar" onclick="openSummaryModal()" title="Library Status">ğŸ“Š</button>
  <button class="btn-topbar mute-btn" id="notif-mute-btn" onclick="Notify.toggleMute()" title="Mute notifications for 24 hours">ğŸ””</button>
</header>

<!-- â”€â”€ Nav Overlay (mobile) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="nav-overlay" class="nav-overlay"></div>

<!-- â”€â”€ Side Drawer (mobile) / Top Nav (desktop) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav id="nav-drawer" class="nav-drawer">
  <div class="nav-header">
    <span class="brand-gnoke">Gnoke</span>
    <span class="brand-app">Library</span>
  </div>
  <button class="nav-btn" data-page="main-page">
    <span class="nav-icon">ğŸ“š</span> Books
  </button>
  <button class="nav-btn" data-page="history-page">
    <span class="nav-icon">ğŸ“‹</span> History
  </button>
  <button class="nav-btn" data-page="return-page">
    <span class="nav-icon">â†©ï¸</span> Returns
  </button>
  <button class="nav-btn" data-page="config-page">
    <span class="nav-icon">âš™ï¸</span> Config
  </button>
  <button class="nav-btn" data-page="about-page">
    <span class="nav-icon">â„¹ï¸</span> About
  </button>
</nav>

<!-- â”€â”€ Desktop Tab Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="tab-bar">
  <button class="tab-btn" data-page="main-page">ğŸ“š Books</button>
  <button class="tab-btn" data-page="history-page">ğŸ“‹ History</button>
  <button class="tab-btn" data-page="return-page">â†©ï¸ Returns</button>
  <button class="tab-btn" data-page="config-page">âš™ï¸ Config</button>
  <button class="tab-btn" data-page="about-page">â„¹ï¸ About</button>
</div>

<!-- â”€â”€ Page Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main class="pages">

  <!-- MAIN: Books -->
  <section id="main-page" class="page">
    <div class="page-header">
      <div>
        <h1>All Books</h1>
        <p class="sub">Total titles: <strong id="book-count">0</strong></p>
      </div>
      <button class="btn-primary" onclick="loadPage('config-page')">+ Add Book</button>
    </div>
    <div class="search-wrap">
      <input type="text" id="search-books" placeholder="Search title, author, ISBN, categoryâ€¦" />
    </div>
    <div class="table-wrap">
      <table id="books-table">
        <thead>
          <tr>
            <th class="num">#</th>
            <th>Author</th>
            <th>Title</th>
            <th class="hide-sm">ISBN</th>
            <th>Category</th>
            <th class="center">Copies</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- HISTORY: Borrow Records -->
  <section id="history-page" class="page">
    <div class="page-header">
      <div>
        <h1>History</h1>
        <p class="sub">All borrow &amp; return records</p>
      </div>
    </div>
    <div class="search-wrap">
      <input type="text" id="search-history" placeholder="Search borrower, title, ISBNâ€¦" />
    </div>
    <div class="table-wrap">
      <table id="history-table">
        <thead>
          <tr>
            <th>Borrower</th>
            <th>Book</th>
            <th class="hide-sm">Date Out</th>
            <th>Due Date</th>
            <th class="hide-sm">Returned</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- RECORD: Borrow a Book -->
  <section id="return-page" class="page">
    <div class="page-header">
      <div>
        <h1>Borrow &amp; Return</h1>
        <p class="sub">Record a loan or process a return</p>
      </div>
    </div>

    <div class="form-grid">

      <!-- Borrow card -->
      <div class="form-card">
        <h2 class="card-title">ğŸ“– Borrow a Book</h2>
        <form id="borrow-form" autocomplete="off">
          <label for="borrower-name">Borrower Name <span class="req">*</span></label>
          <input type="text" id="borrower-name" placeholder="Full name" required />

          <label for="borrow-book-select">Book <span class="req">*</span></label>
          <select id="borrow-book-select" required>
            <option value="">Select Book</option>
          </select>

          <div class="date-row">
            <div>
              <label for="borrow-date-out">Date Out <span class="req">*</span></label>
              <input type="date" id="borrow-date-out" required />
            </div>
            <div>
              <label for="borrow-due-date">Due Date <span class="req">*</span></label>
              <input type="date" id="borrow-due-date" required />
            </div>
          </div>

          <button type="submit" class="btn-primary w-full">Record Borrow</button>
        </form>
      </div>

      <!-- Return card -->
      <div class="form-card">
        <h2 class="card-title">â†©ï¸ Return a Book</h2>
        <form id="return-form" autocomplete="off">
          <label for="return-borrower-select">Borrower <span class="req">*</span></label>
          <select id="return-borrower-select" required>
            <option value="">Select Borrower</option>
          </select>

          <label for="return-book-select">Book <span class="req">*</span></label>
          <select id="return-book-select" required>
            <option value="">Select Book</option>
          </select>

          <label for="return-date">Return Date <span class="req">*</span></label>
          <input type="date" id="return-date" required />

          <button type="submit" class="btn-primary w-full">Record Return</button>
        </form>
      </div>

    </div>
  </section>

  <!-- CONFIG: Add Books, Categories, Backup -->
  <section id="config-page" class="page">
    <div class="page-header">
      <div>
        <h1>Configuration</h1>
        <p class="sub">Books, categories &amp; data management</p>
      </div>
    </div>

    <div class="config-grid">

      <!-- Add Book -->
      <div class="form-card">
        <h2 class="card-title">â• Add New Book</h2>
        <form id="add-book-form" autocomplete="off">
          <label for="add-book-title">Title <span class="req">*</span></label>
          <input type="text" id="add-book-title" placeholder="Book title" required />

          <label for="add-author">Author <span class="req">*</span></label>
          <input type="text" id="add-author" placeholder="Author name" required />

          <label for="add-isbn">ISBN</label>
          <input type="text" id="add-isbn" placeholder="ISBN (optional)" />

          <label for="add-book-category">Category <span class="req">*</span></label>
          <select id="add-book-category" required>
            <option value="">Select Category</option>
          </select>

          <label for="add-copies">Copies</label>
          <input type="number" id="add-copies" value="1" min="1" />

          <button type="submit" class="btn-primary w-full">Add Book</button>
        </form>
      </div>

      <!-- Categories -->
      <div class="form-card">
        <h2 class="card-title">ğŸ·ï¸ Categories</h2>
        <form id="add-category-form" autocomplete="off">
          <label for="add-category-name">New Category</label>
          <div class="inline-form">
            <input type="text" id="add-category-name" placeholder="Category name" />
            <button type="submit" class="btn-primary">Add</button>
          </div>
        </form>
        <ul id="categories-list" class="cat-list"></ul>
      </div>

      <!-- Data Management -->
      <div class="form-card">
        <h2 class="card-title">ğŸ’¾ Data Management</h2>
        <p class="hint">Back up your data regularly. Restore from a previous backup file.</p>
        <div class="data-btns">
          <button class="btn-primary" onclick="handleBackup()">ğŸ“¥ Backup</button>
          <button class="btn-outline" onclick="handleChooseFile()">ğŸ“¤ Restore</button>
          <button class="btn-outline btn-danger" onclick="handleResetDemo()">ğŸ”„ Reset Demo</button>
        </div>
        <input type="file" id="restore-file" accept=".db" style="display:none" />
      </div>

    </div>
  </section>


  <!-- ABOUT -->
  <section id="about-page" class="page">
    <div class="page-header">
      <div>
        <h1>About</h1>
        <p class="sub">Gnoke Library Â· v2.0</p>
      </div>
    </div>

    <div class="config-grid">

      <!-- App info -->
      <div class="form-card">
        <h2 class="card-title">ğŸ“š Gnoke Library</h2>
        <p class="hint" style="margin-bottom:0;line-height:1.8">
          An offline-first library management system for reading rooms,
          small libraries and personal collections.<br><br>
          Track books, manage loans, record returns and get alerts for
          overdue titles â€” all without an account or internet connection.
          Your data never leaves your device.
        </p>
      </div>

      <!-- Tech -->
      <div class="form-card">
        <h2 class="card-title">âš™ï¸ Under The Hood</h2>
        <table style="width:100%;border-collapse:collapse">
          <tbody id="about-tech-table"></tbody>
        </table>
      </div>

      <!-- Stats snapshot -->
      <div class="form-card">
        <h2 class="card-title">ğŸ“Š Library Snapshot</h2>
        <table style="width:100%;border-collapse:collapse">
          <tbody id="about-stats-table"></tbody>
        </table>
      </div>

      <!-- Author & contact -->
      <div class="form-card">
        <h2 class="card-title">ğŸ‘¤ Author</h2>
        <p class="hint"><strong>Edmund Sparrow</strong><br>Part of the Gnoke Suite of offline-first web tools.</p>
        <div class="data-btns" style="margin-top:12px">
          <a class="btn-outline" href="mailto:edmundsparrow@gmail.com" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px">âœ‰ Email</a>
          <a class="btn-outline" href="https://wa.me/09024054758" target="_blank" rel="noopener" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px">ğŸ’¬ WhatsApp</a>
          <a class="btn-outline" href="https://github.com/edmundsparrow/gnoke-library" target="_blank" rel="noopener" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px">âŒ¥ GitHub</a>
        </div>
      </div>

      <!-- License -->
      <div class="form-card">
        <h2 class="card-title">ğŸ“œ License</h2>
        <p class="hint">
          This software is free and open source, licensed under the
          <strong>GNU General Public License v3.0</strong>.<br><br>
          You are free to use, modify and distribute it â€” but any
          distributed version must also be open source under GPL v3.
          Commercial use requires explicit permission from the author.
        </p>
        <p class="hint" style="margin-top:10px;font-family:var(--font-mono);font-size:0.68rem;color:var(--muted)">
          Â© 2026 Edmund Sparrow â€” Gnoke Suite
        </p>
      </div>

    </div>
  </section>

</main>

<!-- â”€â”€ Edit Book Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="edit-book-modal" class="modal">
  <div class="modal-box">
    <div class="modal-head">
      <h2>Edit Book</h2>
      <button class="modal-close" onclick="closeModal('edit-book-modal')">âœ•</button>
    </div>
    <form id="edit-book-form" autocomplete="off">
      <input type="hidden" id="edit-book-id" />
      <label>Title <span class="req">*</span></label>
      <input type="text" id="edit-book-title" required />
      <label>Author <span class="req">*</span></label>
      <input type="text" id="edit-book-author" required />
      <label>Category <span class="req">*</span></label>
      <select id="edit-book-category" required>
        <option value="">Select Category</option>
      </select>
      <div class="modal-actions">
        <button type="button" class="btn-outline" onclick="closeModal('edit-book-modal')">Cancel</button>
        <button type="submit" class="btn-primary">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- â”€â”€ Edit Category Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="edit-category-modal" class="modal">
  <div class="modal-box">
    <div class="modal-head">
      <h2>Edit Category</h2>
      <button class="modal-close" onclick="closeModal('edit-category-modal')">âœ•</button>
    </div>
    <form id="edit-category-form" autocomplete="off">
      <input type="hidden" id="edit-category-id" />
      <label>Category Name <span class="req">*</span></label>
      <input type="text" id="edit-category-name-input" required />
      <div class="modal-actions">
        <button type="button" class="btn-outline" onclick="closeModal('edit-category-modal')">Cancel</button>
        <button type="submit" class="btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- â”€â”€ Summary Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="summary-modal" class="modal">
  <div class="modal-box modal-wide">
    <div class="modal-head">
      <h2>Library Status</h2>
      <button class="modal-close" onclick="closeModal('summary-modal')">âœ•</button>
    </div>
    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-label">Titles</span>
        <span class="stat-val" id="stat-titles">â€”</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Total Copies</span>
        <span class="stat-val" id="stat-copies">â€”</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Active Loans</span>
        <span class="stat-val" id="stat-active">â€”</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Returned</span>
        <span class="stat-val" id="stat-returned">â€”</span>
      </div>
      <div class="stat-card stat-warn">
        <span class="stat-label">Overdue</span>
        <span class="stat-val" id="stat-overdue">â€”</span>
      </div>
    </div>
    <div class="summary-sections">
      <div>
        <h3>Top 5 Borrowed</h3>
        <ul id="top-books-list" class="summary-list"></ul>
      </div>
      <div>
        <h3>Due Today</h3>
        <ul id="due-today-list" class="summary-list"></ul>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toast" class="toast"></div>

<!-- â”€â”€ Scripts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(r => console.log('[SW] registered:', r.scope))
      .catch(e => console.log('[SW] failed:', e));
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script>
<script src="scripts/db-core.js"></script>
<script src="scripts/db-library.js"></script>
<script src="scripts/app.js"></script>
<script src="scripts/notification.js"></script>

</body>
</html>
